<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
<title>Nosso Mercadinho Olypress - Simulador de Compras</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link rel="icon" type="image/png" href="https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/favicon.png">
<meta property="og:image" content="https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/share-image.png">
<style>
        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
          background-color: #000;
          color: #fff;
          line-height: 1.6;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
        }

        body.light-theme {
          background-color: #f5f5f5;
          color: #333;
        }

        .container {
          max-width: 800px;
          width: 100%;
          margin: 0 auto;
          padding: 20px;
          flex: 1;
          display: flex;
          flex-direction: column;
        }

        header {
          background-color: #000;
          color: #f7931e;
          padding: 20px;
          text-align: center;
          position: relative;
        }

        body.light-theme header {
          background-color: #f7931e;
          color: #000;
        }

        h1, h2, h3 {
          margin-bottom: 15px;
        }

        .tela {
          display: none;
          flex: 1;
          width: 100%;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          text-align: center;
        }

        .ativo {
          display: flex;
          animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        .btn, .produto, .pagamento {
          background-color: #f7931e;
          border: none;
          padding: 12px 20px;
          margin: 10px 5px;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          color: #000;
          text-align: center;
          width: 100%;
          max-width: 300px;
          min-height: 48px;
          border: 2px solid #000;
        }

        .btn-caixa {
          background-color: #27ae60 !important;
          color: white !important;
          border: 2px solid #1e8449 !important;
        }

        @media (min-width: 768px) {
          .btn, .produto, .pagamento {
            width: auto;
            min-width: 200px;
          }
        }

        .btn:hover, .produto:hover, .pagamento:hover {
          opacity: 0.9;
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn:disabled {
          background-color: #ccc;
          cursor: not-allowed;
        }

        .categoria {
          font-weight: bold;
          color: #f7931e;
          margin: 20px 0 10px;
          font-size: 1.1em;
          width: 100%;
          max-width: 600px;
          text-align: left;
        }

        body.light-theme .categoria {
          color: #d67c0a;
        }

        .produtos-grid {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 12px;
          width: 100%;
        }

        .sacola-item {
          background-color: #222;
          color: #fff;
          font-size: 1em;
          padding: 14px;
          border-radius: 10px;
          margin: 10px auto;
          max-width: 500px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          transition: background 0.3s ease;
        }
        
        .sacola-item:hover {
          background-color: #f7931e;
          color: #000;
          font-weight: bold;
        }

        body.light-theme .sacola-item {
          background: #eee;
        }

        .contador-sacola {
          position: absolute;
          top: 15px;
          right: 15px;
          background-color: #e74c3c;
          color: white;
          border-radius: 50%;
          width: 24px;
          height: 24px;
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 12px;
          font-weight: bold;
        }

        .notificacao {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background-color: #27ae60;
          color: white;
          padding: 15px 20px;
          border-radius: 8px;
          animation: slideIn 0.5s, fadeOut 0.5s 2.5s forwards;
          z-index: 100;
          display: flex;
          align-items: center;
          gap: 10px;
          max-width: 300px;
        }

        @keyframes slideIn {
          from { transform: translateX(100%); }
          to { transform: translateX(0); }
        }

        @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
        }

        .btn-tema {
          position: absolute;
          top: 20px;
          left: 20px;
          background: transparent;
          border: none;
          color: #f7931e;
          font-size: 1.2em;
          cursor: pointer;
        }

        body.light-theme .btn-tema {
          color: #000;
        }

        #progresso-escaneamento {
          font-weight: bold;
          margin: 15px 0;
          color: #f7931e;
        }

        .produto-escaneado {
          background-color: #4CAF50 !important;
          color: white !important;
        }

        .total-compra {
          font-size: 1.3em;
          margin: 20px 0;
          font-weight: bold;
          color: #f7931e;
        }

        #relogio {
          position: absolute;
          top: 20px;
          right: 60px;
          font-size: 1em;
        }

        .assistente {
          position: fixed;
          bottom: 70px;
          right: 20px;
          background-color: #f7931e;
          color: #000;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.2em;
          cursor: pointer;
          z-index: 90;
        }

        .balao {
          position: absolute;
          bottom: 50px;
          right: 0;
          background-color: #000;
          color: #fff;
          padding: 10px 15px;
          border-radius: 10px;
          max-width: 200px;
          display: none;
          font-size: 0.9em;
        }

        body.light-theme .balao {
          background-color: #fff;
          color: #000;
          border: 1px solid #f7931e;
        }

        .assistente:hover .balao {
          display: block;
          animation: fadeIn 0.3s;
        }

        .flutuante-sacola {
          position: fixed;
          bottom: 70px;
          left: 20px;
          background-color: #f7931e;
          color: #000;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.2em;
          cursor: pointer;
          z-index: 90;
        }

        .tooltip-sacola {
          position: absolute;
          bottom: 50px;
          left: 0;
          background-color: #000;
          color: #fff;
          padding: 10px;
          border-radius: 8px;
          width: 250px;
          display: none;
        }

        body.light-theme .tooltip-sacola {
          background-color: #fff;
          color: #000;
          border: 1px solid #f7931e;
        }

        .flutuante-sacola:hover .tooltip-sacola {
          display: block;
          animation: fadeIn 0.3s;
        }

        .feedback-popup {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: #000;
          color: #fff;
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.3);
          z-index: 1000;
          max-width: 90%;
          width: 400px;
          text-align: center;
          border: 2px solid #f7931e;
          display: none;
        }

        body.light-theme .feedback-popup {
          background-color: #fff;
          color: #000;
        }

        .feedback-popup .btn {
          margin: 15px 5px 0;
          display: inline-block;
          width: auto;
        }

        .social-buttons {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 10px;
          margin-top: 20px;
        }

        .social-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 10px 15px;
          border-radius: 8px;
          color: white;
          text-decoration: none;
          font-weight: bold;
          transition: all 0.3s;
        }

        .social-btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-instagram {
          background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
        }

        .btn-whatsapp {
          background-color: #25D366;
        }

        .btn-franquia {
          background-color: #f7931e;
          color: #000;
        }

        .btn-condominio {
          background-color: #3498db;
        }

        @media (max-width: 480px) {
          .btn, .produto, .pagamento {
            font-size: 1em;
            padding: 14px;
            margin: 8px auto;
          }

          h1, h2, h3 {
            font-size: 1.2em;
          }

          .container {
            padding: 10px;
          }

          .social-btn {
            flex: 1 1 100%;
          }

          .assistente, .flutuante-sacola {
            display: none;
          }
        }

        body {
          line-height: 1.8;
          letter-spacing: 0.5px;
        }

        html {
          scroll-behavior: smooth;
        }

        .produto.adicionado {
          background-color: #4CAF50 !important;
          color: #fff !important;
        }

        .accordion {
          background: linear-gradient(to right, #f7931e, #ffa733);
          color: #000;
          font-weight: bold;
          font-size: 1.1em;
          padding: 14px;
          margin: 12px 0 0;
          border-radius: 10px 10px 0 0;
          border: none;
          box-shadow: 0 2px 6px rgba(0,0,0,0.2);
          transition: background 0.3s ease;
          cursor: pointer;
          width: 100%;
          text-align: left;
          outline: none;
        }

        .accordion:hover {
          background: linear-gradient(to right, #ffa733, #f7931e);
        }

        .panel {
          display: none;
          background-color: #1a1a1a;
          border-left: 3px solid #f7931e;
          border-radius: 0 0 10px 10px;
          padding: 15px 0;
          margin-bottom: 10px;
          flex-direction: column;
          align-items: center;
          width: 100%;
          max-width: 100%;
          transition: max-height 0.3s ease;
        }

        .accordion.active + .panel {
          display: flex !important;
        }

        .tela, .btn, .produto, .pagamento, .accordion, .panel {
          transition: all 0.3s ease-in-out;
        }

        .pontuacao {
          background-color: #333;
          color: #f7931e;
          padding: 15px;
          border-radius: 8px;
          margin: 15px 0;
          text-align: center;
        }

        body.light-theme .pontuacao {
          background-color: #eee;
        }

        .ranking-popup {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: #000;
          color: #fff;
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.3);
          z-index: 1000;
          max-width: 90%;
          width: 400px;
          text-align: center;
          border: 2px solid #f7931e;
          display: none;
        }

        body.light-theme .ranking-popup {
          background-color: #fff;
          color: #000;
        }

        .ranking-popup h3 {
          color: #f7931e;
          margin-bottom: 20px;
        }

        .ranking-item {
          display: flex;
          justify-content: space-between;
          padding: 8px 10px;
          border-bottom: 1px solid #f7931e;
          font-size: 1em;
        }

        .ranking-item:nth-child(1)::before {
          content: "ü•á ";
        }
        .ranking-item:nth-child(2)::before {
          content: "ü•à ";
        }
        .ranking-item:nth-child(3)::before {
          content: "ü•â ";
        }
        .ranking-item:nth-child(n+4)::before {
          content: "üèÖ ";
        }

        .ranking-item:last-child {
          border-bottom: none;
        }

        .combo-badge {
          background-color: #27ae60;
          color: white;
          padding: 3px 8px;
          border-radius: 12px;
          font-size: 0.8em;
          margin-left: 5px;
        }

        .idade-verificacao {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: #000;
          color: #fff;
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.3);
          z-index: 1000;
          max-width: 90%;
          width: 400px;
          text-align: center;
          border: 2px solid #f7931e;
          display: none;
        }

        body.light-theme .idade-verificacao {
          background-color: #fff;
          color: #000;
        }

        .logo-container {
          margin-bottom: 20px;
          text-align: center;
        }

        .logo {
          max-width: 300px;
          width: 100%;
          height: auto;
        }

        .btn-voltar {
          background-color: #333;
          color: white;
          margin-top: 20px;
        }

        body.light-theme .btn-voltar {
          background-color: #555;
        }

        .formulario-popup {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.8);
          z-index: 10000;
          align-items: center;
          justify-content: center;
        }

        .form-container {
          background: #fff;
          padding: 20px;
          border-radius: 10px;
          width: 90%;
          max-width: 500px;
          color: #333;
        }

        .form-container input,
        .form-container select,
        .form-container textarea {
          width: 100%;
          padding: 12px;
          margin: 8px 0;
          border: 1px solid #ddd;
          border-radius: 4px;
          box-sizing: border-box;
        }

        .info-automatica {
          color: #f7931e;
          font-size: 0.9em;
          margin: 10px 0;
        }

        .fechar {
          float: right;
          font-size: 28px;
          cursor: pointer;
          color: #333;
        }

        .instrucao-escaneamento {
          background: #111;
          padding: 15px;
          border-radius: 8px;
          margin: 15px 0;
          text-align: left;
          max-width: 500px;
        }

        body.light-theme .instrucao-escaneamento {
          background: #eee;
          color: #333;
        }

        .instrucao-escaneamento ol {
          padding-left: 20px;
          margin-top: 10px;
        }

        .instrucao-escaneamento li {
          margin-bottom: 8px;
        }

        /* Ajustes para produtos dentro das categorias */
        .panel .produto {
            width: 100%;
            max-width: 320px;
            margin: 6px auto;
            font-size: 1em;
            padding: 12px 16px;
            text-align: center;
            white-space: normal;
            word-break: break-word;
        }

        /* Microintera√ß√µes visuais nos bot√µes */
        .produto {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .produto:active {
            transform: scale(0.95);
            box-shadow: 0 0 12px rgba(247, 147, 30, 0.7);
        }

        /* Glow em hover */
        .produto:hover {
            box-shadow: 0 0 12px rgba(33, 150, 243, 0.7);
        }

        /* Feedback visual check ‚úÖ */
        .produto.adicionado::after {
            content: "‚úîÔ∏è";
            position: absolute;
            right: 12px;
            top: 12px;
            font-size: 1em;
        }

        /* Alinhar centralizado a se√ß√£o "SUA COMPRA" */
        #sacola {
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #sacola h4 {
            text-align: center;
        }

        .balao {
            font-size: 0.95em;
            line-height: 1.4;
            padding: 12px;
            background-color: #1a1a1a;
            border: 1px solid #f7931e;
            border-radius: 10px;
            max-width: 240px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        #barra-progresso .etapa {
            opacity: 0.4;
            transition: opacity 0.3s ease;
        }
        #barra-progresso .etapa.ativa {
            opacity: 1;
            text-decoration: underline;
        }

        .selo-confian√ßa {
            position: fixed;
            bottom: 8px;
            left: 12px;
            background-color: rgba(0, 0, 0, 0.6);
            color: #f7931e;
            font-size: 10.5px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
            z-index: 999;
            pointer-events: none;
            max-width: 200px;
            line-height: 1.2;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }

        body::before {
            content: "NOSSO MERCADINHO OLYPRESS";
            position: fixed;
            bottom: 50%;
            left: 50%;
            transform: translate(-50%, 50%) rotate(-15deg);
            font-size: 2.5em;
            color: rgba(255, 255, 255, 0.03);
            font-weight: bold;
            letter-spacing: 2px;
            pointer-events: none;
            z-index: 0;
        }

        .toast-mensagem {
            position: fixed;
            bottom: 64px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1a1a1a;
            color: #f7931e;
            padding: 10px 16px;
            font-size: 0.9em;
            border-radius: 10px;
            box-shadow: 0 0 12px rgba(0,0,0,0.5);
            opacity: 0.95;
            z-index: 100;
            pointer-events: none;
            display: none;
            animation: fadeinout 5s ease-in-out;
        }

        @keyframes fadeinout {
            0% {opacity: 0;}
            10% {opacity: 0.95;}
            90% {opacity: 0.95;}
            100% {opacity: 0;}
        }

        /* === NOVOS ESTILOS ADICIONADOS === */
        /* Modo Crian√ßa */
        .modo-crianca {
          background: #FFF5E0 !important;
          color: #333 !important;
        }
        .modo-crianca header {
          background: linear-gradient(to right, #5E8CFF, #6BBE92) !important;
        }
        .modo-crianca .btn, .modo-crianca .produto {
          background: #FF9E7D !important;
          border-color: #FF6B6B !important;
          color: #333 !important;
        }

        /* Perfil Idoso */
        .perfil-idoso {
          font-size: 18px;
        }
        .perfil-idoso .btn, .perfil-idoso .produto {
          border-width: 3px !important;
        }

        /* Contador de Doces */
        #contador-doces {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background: #FF6B6B;
          color: white;
          padding: 5px 10px;
          border-radius: 20px;
          z-index: 100;
          display: none;
        }

        /* Anima√ß√µes */
        @keyframes pulse {
          0% { transform: translate(-50%, -50%) scale(1); }
          50% { transform: translate(-50%, -50%) scale(1.2); }
          100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Menu de Perfis */
        .perfil-menu {
          position: fixed;
          top: 60px;
          left: 20px;
          background: rgba(0,0,0,0.8);
          border-radius: 10px;
          padding: 10px;
          z-index: 90;
          display: none;
        }

        .perfil-btn {
          display: block;
          background: #f7931e;
          color: #000;
          border: none;
          padding: 8px 12px;
          margin: 5px 0;
          border-radius: 5px;
          cursor: pointer;
          width: 100%;
          text-align: left;
        }

        .perfil-btn:hover {
          opacity: 0.9;
        }

        .btn-perfil {
          position: absolute;
          top: 20px;
          left: 60px;
          background: transparent;
          border: none;
          color: #f7931e;
          font-size: 1.2em;
          cursor: pointer;
        }

        body.light-theme .btn-perfil {
          color: #000;
        }

        body.light-theme .perfil-menu {
          background: rgba(255,255,255,0.9);
        }

        /* Bot√µes de perfil na tela inicial */
        .botoes-perfil {
          display: flex;
          gap: 10px;
          margin: 20px 0;
          justify-content: center;
          flex-wrap: wrap;
        }

        .btn-perfil-inicial {
          padding: 12px 20px;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          border: none;
          display: flex;
          align-items: center;
          gap: 8px;
          min-width: 150px;
          justify-content: center;
        }

        .btn-crianca {
          background: #FF9E7D;
          color: #333;
        }

        .btn-adulto {
          background: #f7931e;
          color: #000;
        }

        /* Bot√£o flutuante do Instagram */
        .flutuante-instagram {
          position: fixed;
          bottom: 120px;
          right: 20px;
          background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
          color: white;
          width: 50px;
          height: 50px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.5em;
          cursor: pointer;
          z-index: 90;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          animation: pulse 2s infinite;
        }

        .tooltip-instagram {
          position: absolute;
          bottom: 60px;
          right: 0;
          background-color: #000;
          color: #fff;
          padding: 10px;
          border-radius: 8px;
          width: 200px;
          display: none;
          font-size: 0.9em;
        }

        .flutuante-instagram:hover .tooltip-instagram {
          display: block;
          animation: fadeIn 0.3s;
        }

        @media (max-width: 768px) {
          .flutuante-instagram {
            bottom: 80px;
            right: 15px;
            width: 45px;
            height: 45px;
            font-size: 1.3em;
          }
        }
</style>
</head>
<body>
<audio id="click-sound" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5b4693151f.mp3?filename=click-124467.mp3"></audio>
<div class="container">
<button class="btn-tema" onclick="alternarTema()"><i class="fas fa-moon"></i></button>
<button class="btn-perfil" onclick="alternarMenuPerfil()"><i class="fas fa-user"></i></button>
<div class="perfil-menu" id="perfilMenu">
  <button class="perfil-btn" onclick="definirPerfil('padrao')"><i class="fas fa-user"></i> Padr√£o</button>
  <button class="perfil-btn" onclick="definirPerfil('crianca')"><i class="fas fa-child"></i> Crian√ßa</button>
  <button class="perfil-btn" onclick="definirPerfil('idoso')"><i class="fas fa-blind"></i> Idoso</button>
  <button class="perfil-btn" onclick="definirPerfil('jovem')"><i class="fas fa-running"></i> Jovem</button>
</div>
<div id="barra-progresso" style="width: 100%; background-color: #1a1a1a; padding: 10px 0; text-align: center; font-size: 0.9em; color: #f7931e; font-weight: bold; border-bottom: 1px solid #333;">
<span class="etapa" data-etapa="entrada">üèÅ Entrada</span> ‚Üí
    <span class="etapa" data-etapa="produtos">üõí Produtos</span> ‚Üí
    <span class="etapa" data-etapa="caixa">üí≥ Caixa</span> ‚Üí
    <span class="etapa" data-etapa="pagamento">üí∞ Pagamento</span> ‚Üí
    <span class="etapa" data-etapa="final">üéâ Final</span>
</div>
<div id="relogio"></div>
<header>
<div class="logo-container">
<img alt="Nosso Mercadinho Olypress" class="logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MDAgMTAwIj48cmVjdCB3aWR0aD0iNTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzAwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZjc5MzFlIiBmb250LWZhbWlseT0iJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjQiPk5vc3NvIE1lcmNhZGluaG8gT0xZUFJFU1M8L3RleHQ+PC9zdmc+"/>
</div>
<p>Rede de Mercados Aut√¥nomos 24h ‚Äî Franquia com prop√≥sito.</p>
<div class="contador-sacola" id="contador-sacola">0</div>
</header>
<div class="tela ativo" id="entrada">
<div>
<h2 style="font-size: 1.5em; margin-bottom: 20px;">SEJA BEM-VINDO AO NOSSO MERCADINHO OLYPRESS</h2>
<p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 30px; text-align: center;">
                    Aqui, a confian√ßa vem antes da tecnologia.<br/><br/>
                    N√£o √© preciso senha, reconhecimento facial ou cadastro.<br/><br/>
<strong style="font-weight: bold; color: #f7931e;">√â s√≥ entrar, escolher, pagar... e voltar sempre que quiser.</strong>
</p>

<!-- Bot√µes de perfil adicionados na tela inicial -->
<div class="botoes-perfil">
  <button class="btn-perfil-inicial btn-crianca" onclick="definirPerfil('crianca')">
    <i class="fas fa-child"></i> Modo Crian√ßa
  </button>
  <button class="btn-perfil-inicial btn-adulto" onclick="definirPerfil('padrao')">
    <i class="fas fa-user"></i> Modo Adulto
  </button>
</div>

<button class="btn" onclick="iniciarExperiencia()"><i class="fas fa-shopping-basket"></i> ENTRAR NA LOJA</button>
<button class="btn" onclick="mostrarRanking()" style="margin-top: 10px;"><i class="fas fa-trophy"></i> VER RANKING</button>
</div>
</div>
<div class="tela" id="produtos">
<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; padding: 10px;">
<h3>ESCOLHA SEUS PRODUTOS</h3>
<div class="produtos-grid">
<button class="accordion">BEBIDAS</button>
<div class="panel">
<button class="produto" onclick="adicionarProduto('Coca-Cola Lata', 5.50)" aria-label="Adicionar Coca-Cola Lata ao carrinho por R$ 5,50">Coca-Cola - R$ 5,50</button>
<button class="produto" onclick="adicionarProduto('√Ågua sem g√°s', 3.00)" aria-label="Adicionar √Ågua sem g√°s ao carrinho por R$ 3,00">üíß √Ågua sem g√°s - R$ 3,00</button>
<button class="produto" onclick="adicionarProduto('Suco de Uva', 6.90)" aria-label="Adicionar Suco de Uva ao carrinho por R$ 6,90">üçá Suco de Uva - R$ 6,90</button>
</div>
<button class="accordion">SNACKS</button>
<div class="panel">
<button class="produto" onclick="adicionarProduto('Doritos', 8.50)" aria-label="Adicionar Doritos ao carrinho por R$ 8,50">üî∂ Doritos - R$ 8,50</button>
<button class="produto" onclick="adicionarProduto('Cheetos', 7.90)" aria-label="Adicionar Cheetos ao carrinho por R$ 7,90">üßÄ Cheetos - R$ 7,90</button>
</div>
<button class="accordion">DOCES</button>
<div class="panel">
<button class="produto" onclick="adicionarProduto('Fini', 2.50)" aria-label="Adicionar Fini ao carrinho por R$ 2,50">üç¨ Fini - R$ 2,50</button>
<button class="produto" onclick="adicionarProduto('KitKat', 4.90)" aria-label="Adicionar KitKat ao carrinho por R$ 4,90">üç´ KitKat - R$ 4,90</button>
</div>
<button class="accordion">PADARIA</button>
<div class="panel">
<button class="produto" onclick="adicionarProduto('P√£o de forma', 9.90)" aria-label="Adicionar P√£o de forma ao carrinho por R$ 9,90">üçû P√£o de forma - R$ 9,90</button>
<button class="produto" onclick="adicionarProduto('Caf√© Sol√∫vel', 12.50)" aria-label="Adicionar Caf√© Sol√∫vel ao carrinho por R$ 12,50">‚òï Caf√© Sol√∫vel - R$ 12,50</button>
</div>
<button class="accordion">ORG√ÇNICOS</button>
<div class="panel">
<button class="produto" onclick="adicionarProduto('Ma√ß√£ Org√¢nica', 4.50)" aria-label="Adicionar Ma√ß√£ Org√¢nica ao carrinho por R$ 4,50">üçè Ma√ß√£ Org√¢nica - R$ 4,50</button>
<button class="produto" onclick="adicionarProduto('Suco Natural', 7.50)" aria-label="Adicionar Suco Natural ao carrinho por R$ 7,50">üçπ Suco Natural - R$ 7,50</button>
</div>
<button class="accordion">BEBIDAS ALCO√ìLICAS</button>
<div class="panel">
<button class="produto" onclick="verificarIdade('Cerveja Artesanal', 12.90)" aria-label="Verificar idade para Cerveja Artesanal por R$ 12,90">üç∫ Cerveja Artesanal - R$ 12,90</button>
<button class="produto" onclick="verificarIdade('Vinho Tinto', 45.00)" aria-label="Verificar idade para Vinho Tinto por R$ 45,00">üç∑ Vinho Tinto - R$ 45,00</button>
</div>
<button class="accordion">PRODUTOS LOCAIS</button>
<div class="panel">
<button class="produto" onclick="adicionarProduto('Mel Artesanal', 18.00)" aria-label="Adicionar Mel Artesanal ao carrinho por R$ 18,00">üçØ Mel Artesanal - R$ 18,00</button>
<button class="produto" onclick="adicionarProduto('Queijo Mineiro', 22.50)" aria-label="Adicionar Queijo Mineiro ao carrinho por R$ 22,50">üßÄ Queijo Mineiro - R$ 22,50</button>
</div>
</div>
<button class="btn btn-caixa" onclick="mostrar('caixa')"><i class="fas fa-cash-register"></i> IR PARA O CAIXA</button>
<button class="btn btn-voltar" onclick="mostrar('entrada')"><i class="fas fa-arrow-left"></i> VOLTAR</button>
</div>
</div>
<div class="tela" id="caixa">
<div>
<h3><i class="fas fa-barcode"></i> CAIXA AUTOM√ÅTICO</h3>
<div class="instrucao-escaneamento">
  <p>üîç <strong>Como funciona:</strong></p>
  <ol>
    <li>Clique em cada produto abaixo para simular o escaneamento</li>
    <li>O item ficar√° verde quando escaneado</li>
    <li>Quando todos estiverem verdes, prossiga para pagamento</li>
  </ol>
</div>
<div id="progresso-escaneamento">0 de 0 produtos escaneados</div>
<div id="escaneamento" style="width: 100%; max-width: 500px;"></div>
<button class="btn" id="btnPagamento" onclick="mostrar('pagamento')" style="display:none;"><i class="fas fa-credit-card"></i> PAGAMENTO</button>
<button class="btn btn-voltar" onclick="mostrar('produtos')"><i class="fas fa-arrow-left"></i> VOLTAR</button>
</div>
</div>
<div class="tela" id="pagamento">
<div>
<h3><i class="fas fa-wallet"></i> FORMA DE PAGAMENTO</h3>
<div class="total-compra">TOTAL: R$ <span id="total-pagamento">0.00</span></div>
<button class="pagamento" onclick="finalizarCompra('PIX')"><i class="fas fa-qrcode"></i> PIX</button>
<button class="pagamento" onclick="finalizarCompra('D√âBITO')"><i class="fas fa-credit-card"></i> D√âBITO</button>
<button class="pagamento" onclick="finalizarCompra('CR√âDITO')"><i class="fas fa-credit-card"></i> CR√âDITO</button>
<button class="pagamento" onclick="finalizarCompra('DINHEIRO')"><i class="fas fa-money-bill-wave"></i> DINHEIRO</button>
<button class="btn btn-voltar" onclick="mostrar('caixa')"><i class="fas fa-arrow-left"></i> VOLTAR</button>
</div>
</div>
<div class="tela" id="final">
<div>
<h3><i class="fas fa-check-circle"></i> COMPRA FINALIZADA!</h3>
<p>Obrigado por comprar no Nosso Mercadinho Olypress</p>
<div class="pontuacao" id="pontuacao-container">
<h4>SUA PONTUA√á√ÉO</h4>
<div id="pontuacao-detalhes"></div>
</div>
<a class="social-btn btn-whatsapp" onclick="compartilharWhatsApp('Fiz%20minha%20compra%20no%20Nosso%20Mercadinho%20Olypress!%20Tente%20tamb√©m:%20https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/')" style="margin-top: 20px; cursor: pointer;">
<i class="fas fa-gamepad"></i> Desafiar um amigo
</a>
<div class="total-compra">
                    Total: R$ <span id="total-final">0.00</span> (<span id="metodo-pagamento">PIX</span>)
                </div>
<div id="sacola" style="width: 100%; max-width: 500px;"></div>
<p id="tempo-final" style="margin-top: 10px; font-weight: bold; color: #f7931e;"></p>
<button class="btn" onclick="reiniciar()"><i class="fas fa-redo"></i> NOVA COMPRA</button>
<button class="btn" onclick="mostrarRanking()" style="margin-top: 10px;"><i class="fas fa-trophy"></i> VER RANKING</button>
<div id="sugestao-produto" style="margin-top:20px; font-size:1em; color:#f7931e; font-weight:bold;"></div><div id="resumo-emocional" style="margin-top: 25px; font-size: 1.1em; color: #f7931e; text-align: center; font-weight: bold;"></div>
<div style="margin-top: 40px; text-align: center;">
<p style="font-size: 1.2em; font-weight: bold;">Gostou da experi√™ncia?</p>
<p>Compartilhe com um amigo ou desafie algu√©m a comprar tamb√©m!</p>
</div>
<div class="social-buttons">
<a class="social-btn btn-whatsapp" onclick="compartilharWhatsApp('Experimente%20o%20Nosso%20Mercadinho%20Olypress:%20https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/')" style="cursor: pointer;">
<i class="fab fa-whatsapp"></i> WhatsApp
                    </a>
<a class="social-btn btn-condominio" href="https://www.facebook.com/sharer/sharer.php?u=https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/" target="_blank">
<i class="fab fa-facebook-f"></i> Facebook
                    </a>
<a class="social-btn btn-franquia" href="https://twitter.com/intent/tweet?text=Experimente%20o%20mercadinho%20aut√¥nomo!&amp;url=https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/" target="_blank">
<i class="fab fa-twitter"></i> Twitter
                    </a>
<a class="social-btn btn-franquia" href="https://www.linkedin.com/sharing/share-offsite/?url=https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/" target="_blank">
<i class="fab fa-linkedin-in"></i> LinkedIn
                    </a>
<button class="social-btn btn-franquia" onclick="copiarLink()">
<i class="fas fa-link"></i> Copiar link do jogo
                    </button>
</div>
<div style="margin-top: 50px; text-align: center;">
<p style="font-size: 1.2em; font-weight: bold;">Leve essa experi√™ncia para mais pessoas!</p>
<p>Indique o Nosso Mercadinho Olypress para seu condom√≠nio ou torne-se um franqueado:</p>
<div class="social-buttons">
<button class="social-btn btn-condominio" onclick="mostrarForm('Condominio')">
<i class="fas fa-home"></i> Quero no meu condom√≠nio
                        </button>
<button class="social-btn btn-franquia" onclick="mostrarForm('Franqueado')">
<i class="fas fa-store"></i> Seja franqueado
                        </button>
</div>
</div>
<div id="avaliacao-final" style="margin-top: 50px; text-align: center;">
<p style="font-size: 1.2em; font-weight: bold;">O que voc√™ mais gostou dessa experi√™ncia?</p>
<div style="margin-top: 10px;">
<button class="btn" onclick="compartilharOpiniao('A facilidade de comprar')">‚òë A facilidade de comprar</button>
<button class="btn" onclick="compartilharOpiniao('A ideia do mercadinho aut√¥nomo')">‚òë A ideia do mercadinho aut√¥nomo</button>
<button class="btn" onclick="compartilharOpiniao('Tudo! √â incr√≠vel.')">‚òë Tudo! √â incr√≠vel.</button>
</div>
<div id="bloco-compartilhamento" style="display:none; margin-top: 30px;">
<p>Compartilhe sua opini√£o nas redes sociais:</p>
<div class="social-buttons">
<a class="social-btn btn-whatsapp" onclick="compartilharWhatsApp('No%20Nosso%20Mercadinho%20Olypress,%20o%20que%20mais%20gostei%20foi:%20[OPINIAO].%20Experimente%20tamb√©m!%20https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/')" style="cursor: pointer;">
<i class="fab fa-whatsapp"></i> WhatsApp
</a>
<a class="social-btn btn-condominio" id="facebook-link" target="_blank"><i class="fab fa-facebook-f"></i> Facebook</a>
<a class="social-btn btn-franquia" id="twitter-link" target="_blank"><i class="fab fa-twitter"></i> Twitter</a>
</div>
<div style="margin-top:20px;">
<p style="font-weight: bold;">Para compartilhar no Instagram:</p>
<textarea id="instagram-texto" style="width:90%; max-width:400px; height:80px; padding:10px; border-radius:8px;">Acabei de comprar no Nosso Mercadinho Olypress. O que mais gostei? [OPINIAO]. Voc√™ precisa experimenter tamb√©m! @nossomercadinhoolypress</textarea>
<br/>
<button class="btn" onclick="copiarTextoInstagram()">Copiar texto</button>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="flutuante-sacola">
<i class="fas fa-shopping-basket"></i>
<div class="tooltip-sacola">
<div id="tooltip-itens" style="max-height: 200px; overflow-y: auto;"></div>
<hr style="margin: 10px 0; border-color: #f7931e;"/>
<strong>Total: R$ <span id="tooltip-total">0.00</span></strong>
</div>
</div>
<div class="assistente">
<i class="fas fa-robot"></i>
<div class="balao" id="mensagem-assistente">Ol√°! Posso ajudar?</div>
</div>

<!-- Bot√£o flutuante do Instagram -->
<div class="flutuante-instagram" id="flutuanteInstagram">
  <i class="fab fa-instagram"></i>
  <div class="tooltip-instagram">Siga-nos no Instagram para mais novidades!</div>
</div>

<div class="feedback-popup" id="feedbackPopup">
<h3>Achou f√°cil comprar?</h3>
<p id="fraseFeedback">No Nosso Mercadinho Olypress √© t√£o simples quanto esse jogo!</p>
<button class="btn" onclick="fecharFeedback()"><i class="fas fa-thumbs-up"></i> FECHAR</button>
</div>
<div class="ranking-popup" id="rankingPopup">
<h3><i class="fas fa-trophy"></i> TOP 5 MELHORES JOGADORES</h3>
<div id="ranking-lista"></div>
<button class="btn" onclick="fecharRanking()" style="margin-top: 20px;"><i class="fas fa-times"></i> FECHAR</button>
</div>
<div class="idade-verificacao" id="idadeVerificacao">
<h3>VERIFICA√á√ÉO DE IDADE</h3>
<p>Voc√™ tem 18 anos ou mais?</p>
<button class="btn" onclick="confirmarIdade(true)">SIM, TENHO 18+</button>
<button class="btn" onclick="confirmarIdade(false)">N√ÉO TENHO 18+</button>
</div>

<!-- Formul√°rios Popup -->
<div class="formulario-popup" id="formCondominio">
  <div class="form-container">
    <span class="fechar" onclick="fecharForm('Condominio')">&times;</span>
    <h3>Quero no meu condom√≠nio</h3>
    <form id="formCondominioData">
      <input type="text" placeholder="Seu nome*" required>
      <select required>
        <option value="">Voc√™ √©...*</option>
        <option>S√≠ndico</option>
        <option>Administrador</option>
        <option>Presidente</option>
        <option>Morador</option>
        <option>Outro</option>
      </select>
      <input type="number" placeholder="Quantas resid√™ncias?*" required>
      <p class="info-automatica">Atendemos somente Piracicaba no momento</p>
      <button type="submit">Enviar interesse</button>
    </form>
  </div>
</div>

<div class="formulario-popup" id="formFranqueado">
  <div class="form-container">
    <span class="fechar" onclick="fecharForm('Franqueado')">&times;</span>
    <h3>Seja franqueado</h3>
    <form id="formFranqueadoData">
      <input type="text" placeholder="Seu nome*" required>
      <input type="text" placeholder="Sua profiss√£o*" required>
      <select required>
        <option value="">Tem experi√™ncia no ramo?*</option>
        <option>Sim, no ramo de mercados</option>
        <option>Sim, em gest√£o</option>
        <option>N√£o, mas tenho interesse</option>
      </select>
      <textarea placeholder="Por que deseja abrir uma franquia?*" required></textarea>
      <button type="submit">Enviar interesse</button>
    </form>
  </div>
</div>

<div id="contador-doces"></div>

<script>
        // Vari√°veis globais
let sacola = [];
let tempoInicio;
let temaEscuro = true;
let ranking = JSON.parse(localStorage.getItem('ranking')) || [];
let produtoAlcoolicoPendente = null;
let perfilUsuario = localStorage.getItem('perfilOlypress') || 'padrao';
let docesColetados = parseInt(localStorage.getItem('docesOletados')) || 0;

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', function() {
    atualizarRelogio();
    setInterval(atualizarRelogio, 1000);
    
    // Configura accordions
    const accordions = document.querySelectorAll('.accordion');
    accordions.forEach(accordion => {
        accordion.addEventListener('click', function() {
            this.classList.toggle('active');
            const panel = this.nextElementSibling;
            if (panel.style.display === 'flex') {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'flex';
            }
        });
    });
    
    // Configura hover do assistente
    const assistente = document.querySelector('.assistente');
    assistente.addEventListener('click', function() {
        const mensagens = [
            "Oi! Posso te ajudar com algo aqui no Mercadinho? üòä",
            "Qualquer hora, qualquer dia. √â s√≥ entrar, escolher e pagar.",
            "Temos produtos incr√≠veis esperando por voc√™!",
            "Ficou com d√∫vida? Chama no Instagram: @olypressnossomercadinho"
        ];
        const mensagemAleatoria = mensagens[Math.floor(Math.random() * mensagens.length)];
        document.getElementById('mensagem-assistente').textContent = mensagemAleatoria;
    });
    
    // Configura hover da sacola flutuante
    const flutuanteSacola = document.querySelector('.flutuante-sacola');
    flutuanteSacola.addEventListener('click', function() {
        atualizarTooltipSacola();
    });

    // Configurar formul√°rios
    document.getElementById('formCondominioData').addEventListener('submit', function(e) {
        e.preventDefault();
        enviarFormulario('Condominio', this);
    });

    document.getElementById('formFranqueadoData').addEventListener('submit', function(e) {
        e.preventDefault();
        enviarFormulario('Franqueado', this);
    });

    // Configurar bot√£o flutuante do Instagram
    const flutuanteInstagram = document.getElementById('flutuanteInstagram');
    flutuanteInstagram.addEventListener('click', function() {
        window.open('https://www.instagram.com/olypressnossomercadinho?igsh=MTN3ZTJ2N3V4b2xm', '_blank');
    });

    // Aplicar perfil salvo
    if (perfilUsuario === 'crianca') {
        ativarModoCrianca();
    } else if (perfilUsuario) {
        aplicarEstiloPerfil();
    }
});

// Fun√ß√£o para compartilhar via WhatsApp
function compartilharWhatsApp(texto) {
    // Primeiro tenta abrir o app nativo
    window.location.href = `whatsapp://send?text=${texto}`;
    
    // Se n√£o funcionar, abre o WhatsApp Web ap√≥s um pequeno delay
    setTimeout(() => {
        if (!document.hidden) {
            window.open(`https://web.whatsapp.com/send?text=${texto}`, '_blank');
        }
    }, 500);
}

// Fun√ß√µes de navega√ß√£o
function mostrar(tela) {
    atualizarBarraProgresso(tela);
    document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativo'));
    document.getElementById(tela).classList.add('ativo');
    
    if (tela === 'caixa') {
        iniciarEscaneamento();
    } else if (tela === 'pagamento') {
        document.getElementById('total-pagamento').textContent = calcularTotal().toFixed(2);
    } else if (tela === 'final') {
        finalizarExperiencia();
    }
}

function iniciarExperiencia() {
    tempoInicio = new Date();
    mostrar('produtos');
}

function reiniciar() {
    sacola = [];
    atualizarContadorSacola();
    mostrar('entrada');
}

// Fun√ß√µes de produtos
function adicionarProduto(nome, preco) {
    sacola.push({ nome, preco, escaneado: false });
    atualizarContadorSacola();
    
    // Mostrar notifica√ß√£o
    mostrarNotificacao(`"${nome}" adicionado √† sacola`);
    
    // Destacar bot√£o do produto
    const botaoProduto = [...document.querySelectorAll('.produto')].find(b => 
        b.textContent.includes(nome.split(' - ')[0])
    );
    if (botaoProduto) {
        botaoProduto.classList.add('adicionado');
        setTimeout(() => {
            botaoProduto.classList.remove('adicionado');
        }, 1000);
    }

    // Verificar miss√£o para crian√ßas
    if (perfilUsuario === 'crianca') {
        verificarMissaoCrianca();
    }
}

function verificarIdade(nome, preco) {
    produtoAlcoolicoPendente = { nome, preco };
    document.getElementById('idadeVerificacao').style.display = 'block';
}

function confirmarIdade(maiorDeIdade) {
    document.getElementById('idadeVerificacao').style.display = 'none';
    
    if (maiorDeIdade && produtoAlcoolicoPendente) {
        adicionarProduto(produtoAlcoolicoPendente.nome, produtoAlcoolicoPendente.preco);
    } else if (!maiorDeIdade) {
        mostrarNotificacao('Produto restrito a maiores de 18 anos');
    }
    
    produtoAlcoolicoPendente = null;
}

// Fun√ß√µes do caixa
function iniciarEscaneamento() {
    const escaneamentoDiv = document.getElementById('escaneamento');
    escaneamentoDiv.innerHTML = '';
    
    if (sacola.length === 0) {
        escaneamentoDiv.innerHTML = '<p>Sua sacola est√° vazia</p>';
        return;
    }
    
    sacola.forEach((item, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'sacola-item';
        if (item.escaneado) {
            itemDiv.classList.add('produto-escaneado');
        }
        itemDiv.innerHTML = `
            <span>${item.nome}</span>
            <span>R$ ${item.preco.toFixed(2)}</span>
        `;
        itemDiv.addEventListener('click', () => escanearItem(index));
        escaneamentoDiv.appendChild(itemDiv);
    });
    
    atualizarProgressoEscaneamento();
}

function escanearItem(index) {
    if (!sacola[index].escaneado) {
        sacola[index].escaneado = true;
        mostrarNotificacao(`"${sacola[index].nome}" escaneado`);
        atualizarProgressoEscaneamento();
        
        // Verificar se todos os itens foram escaneados
        const todosEscaneados = sacola.every(item => item.escaneado);
        document.getElementById('btnPagamento').style.display = todosEscaneados ? 'block' : 'none';
    }
}

function atualizarProgressoEscaneamento() {
    const escaneados = sacola.filter(item => item.escaneado).length;
    document.getElementById('progresso-escaneamento').textContent = 
        `${escaneados} de ${sacola.length} produtos escaneados`;
    
    // Atualizar visualiza√ß√£o dos itens
    const itens = document.querySelectorAll('.sacola-item');
    itens.forEach((item, index) => {
        if (sacola[index].escaneado) {
            item.classList.add('produto-escaneado');
        } else {
            item.classList.remove('produto-escaneado');
        }
    });
}

// Fun√ß√µes de pagamento
function finalizarCompra(metodo) {
    const total = calcularTotal();
    
    if (sacola.length === 0) {
        mostrarNotificacao("Sua sacola est√° vazia! Adicione itens antes de finalizar.");
        return;
    }

    const tempoFinal = new Date();
    const tempoDecorrido = Math.floor((tempoFinal - tempoInicio) / 1000);
    const pontos = Math.max(1, Math.floor(1000 / tempoDecorrido) * sacola.length);
    
    let nomeJogador = "An√¥nimo";
    try {
        nomeJogador = prompt('Digite seu nome para o ranking (m√°x. 20 caracteres):', 'An√¥nimo') || 'An√¥nimo';
        nomeJogador = nomeJogador.substring(0, 20);
    } catch (e) {
        console.error("Erro ao obter nome:", e);
    }

    const dadosJogador = {
        nome: nomeJogador,
        pontos: pontos,
        tempo: tempoDecorrido,
        total: total,
        data: new Date().toLocaleDateString(),
        metodo: metodo
    };

    if (!salvarNoRanking(dadosJogador)) {
        mostrarNotificacao("Seu score foi registrado apenas nesta sess√£o");
    }

    document.getElementById('total-final').textContent = total.toFixed(2);
    document.getElementById('metodo-pagamento').textContent = metodo;
    mostrar('final');
}

function salvarNoRanking(dados) {
    try {
        const rankingAtual = JSON.parse(localStorage.getItem('ranking')) || [];
        const novoRanking = [...rankingAtual, dados]
            .sort((a, b) => b.pontos - a.pontos)
            .slice(0, 50);
        localStorage.setItem('ranking', JSON.stringify(novoRanking));
        return true;
    } catch (e) {
        console.error("Erro ao acessar localStorage:", e);
        window.sessionRanking = window.sessionRanking || [];
        window.sessionRanking.push(dados);
        return false;
    }
}

// Fun√ß√µes da tela final
function finalizarExperiencia() {
    const tempoFinal = new Date();
    const tempoDecorrido = Math.floor((tempoFinal - tempoInicio) / 1000);
    const total = calcularTotal();
    
    document.getElementById('tempo-final').textContent = `Tempo total: ${tempoDecorrido} segundos`;
    
    const pontos = Math.max(1, Math.floor(1000 / tempoDecorrido) * sacola.length);
    document.getElementById('pontuacao-detalhes').innerHTML = `
        <div style="font-size: 2em; margin: 10px 0;">${pontos} pontos</div>
        <div>${sacola.length} itens em ${tempoDecorrido} segundos</div>
    `;
    
    const sacolaDiv = document.getElementById('sacola');
    sacolaDiv.innerHTML = '<h4 style="margin-bottom: 10px;">SUA COMPRA</h4>';
    
    sacola.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'sacola-item';
        itemDiv.innerHTML = `
            <span>${item.nome}</span>
            <span>R$ ${item.preco.toFixed(2)}</span>
        `;
        sacolaDiv.appendChild(itemDiv);
    });
    
    const sugestoes = {
        'Coca-Cola': 'Que tal uma batata chips para acompanhar?',
        'Cerveja Artesanal': 'Experimente nosso queijo mineiro para harmonizar!',
        'Caf√© Sol√∫vel': 'Temos biscoitos artesanais que combinam perfeitamente.'
    };
    
    let sugestao = 'Volte sempre ao Nosso Mercadinho Olypress!';
    for (const [produto, mensagem] of Object.entries(sugestoes)) {
        if (sacola.some(item => item.nome.includes(produto))) {
            sugestao = mensagem;
            break;
        }
    }
    
    document.getElementById('sugestao-produto').textContent = sugestao;
    gerarResumoEmocionalDaCompra();
    
    // Adicionar feedback personalizado se houver
    const feedback = gerarFeedbackPersonalizado();
    if (feedback) {
        document.getElementById('resumo-emocional').textContent += ` ${feedback}`;
    }
}

// Fun√ß√µes auxiliares
function calcularTotal() {
    return sacola.reduce((total, item) => total + item.preco, 0);
}

function atualizarContadorSacola() {
    document.getElementById('contador-sacola').textContent = sacola.length;
    atualizarTooltipSacola();
}

function atualizarTooltipSacola() {
    const tooltipItens = document.getElementById('tooltip-itens');
    tooltipItens.innerHTML = '';
    
    if (sacola.length === 0) {
        tooltipItens.innerHTML = '<p>Sua sacola est√° vazia</p>';
    } else {
        sacola.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.style.display = 'flex';
            itemDiv.style.justifyContent = 'space-between';
            itemDiv.style.margin = '5px 0';
            itemDiv.innerHTML = `
                <span>${item.nome}</span>
                <span>R$ ${item.preco.toFixed(2)}</span>
            `;
            tooltipItens.appendChild(itemDiv);
        });
    }
    
    document.getElementById('tooltip-total').textContent = calcularTotal().toFixed(2);
}

function mostrarNotificacao(mensagem) {
    const notificacao = document.createElement('div');
    notificacao.className = 'notificacao';
    notificacao.innerHTML = `<i class="fas fa-check-circle"></i> ${mensagem}`;
    document.body.appendChild(notificacao);
    
    setTimeout(() => {
        notificacao.remove();
    }, 3000);
}

function alternarTema() {
    temaEscuro = !temaEscuro;
    document.body.classList.toggle('light-theme');
    
    const btnTema = document.querySelector('.btn-tema');
    if (temaEscuro) {
        btnTema.innerHTML = '<i class="fas fa-moon"></i>';
    } else {
        btnTema.innerHTML = '<i class="fas fa-sun"></i>';
    }
}

function atualizarRelogio() {
    const agora = new Date();
    const horas = agora.getHours().toString().padStart(2, '0');
    const minutos = agora.getMinutes().toString().padStart(2, '0');
    document.getElementById('relogio').textContent = `${horas}:${minutos}`;
}

// Fun√ß√µes de ranking
function mostrarRanking() {
    const rankingLista = document.getElementById('ranking-lista');
    rankingLista.innerHTML = '';
    
    let dadosRanking = [];
    
    try {
        dadosRanking = JSON.parse(localStorage.getItem('ranking')) || [];
    } catch (e) {
        console.error("Erro ao ler ranking:", e);
        dadosRanking = window.sessionRanking || [];
    }

    const top5 = dadosRanking.slice(0, 5);
    
    if (top5.length === 0) {
        rankingLista.innerHTML = '<p>Nenhum registro ainda. Seja o primeiro!</p>';
    } else {
        top5.forEach((jogador, index) => {
            const item = document.createElement('div');
            item.className = 'ranking-item';
            item.innerHTML = `
                <span>${index + 1}. ${jogador.nome}</span>
                <span>${jogador.pontos} pts</span>
            `;
            rankingLista.appendChild(item);
        });
    }
    
    document.getElementById('rankingPopup').style.display = 'block';
    document.querySelector('#rankingPopup button').focus();
}

function fecharRanking() {
    document.getElementById('rankingPopup').style.display = 'none';
}

// Fun√ß√µes de feedback
function compartilharOpiniao(opiniao) {
    const texto = `No Nosso Mercadinho Olypress, o que mais gostei foi: ${opiniao}. Experimente tamb√©m!`;
    
    document.getElementById('whatsapp-link').href = 
        `https://wa.me/5519996600929?text=${encodeURIComponent(texto)}%20https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/`;
    document.getElementById('facebook-link').href = 
        `https://www.facebook.com/sharer/sharer.php?u=https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/&quote=${encodeURIComponent(texto)}`;
    document.getElementById('twitter-link').href = 
        `https://twitter.com/intent/tweet?text=${encodeURIComponent(texto)}&url=https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/`;
    
    document.getElementById('instagram-texto').value = 
        texto.replace('No Nosso Mercadinho Olypress, ', '') + ' #Olypress #Autonomia #Conveniencia';
    
    document.getElementById('bloco-compartilhamento').style.display = 'block';
}

function copiarTextoInstagram() {
    const texto = document.getElementById('instagram-texto');
    texto.select();
    document.execCommand('copy');
    mostrarNotificacao('Texto copiado para o Instagram!');
}

function copiarLink() {
    const link = 'https://nossomercadinhoolypress.github.io/Game-Nosso-Mercadinho-/';
    navigator.clipboard.writeText(link).then(() => {
        mostrarNotificacao('Link copiado! Compartilhe com seus amigos.');
    });
}

function mostrarFeedback() {
    const frases = [
        "No Nosso Mercadinho Olypress √© t√£o simples quanto esse jogo!",
        "Autonomia e confian√ßa em primeiro lugar!",
        "Comprar nunca foi t√£o f√°cil e r√°pido.",
        "Experimente na vida real tamb√©m!"
    ];
    const fraseAleatoria = frases[Math.floor(Math.random() * frases.length)];
    document.getElementById('fraseFeedback').textContent = fraseAleatoria;
    document.getElementById('feedbackPopup').style.display = 'block';
}

function fecharFeedback() {
    document.getElementById('feedbackPopup').style.display = 'none';
}

// Fun√ß√µes dos formul√°rios
function mostrarForm(tipo) {
    document.getElementById(`form${tipo}`).style.display = 'flex';
}

function fecharForm(tipo) {
    document.getElementById(`form${tipo}`).style.display = 'none';
}

function enviarFormulario(tipo, form) {
    const btn = form.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.textContent = 'Enviando...';
    
    // Simular envio (substituir por chamada real)
    setTimeout(() => {
        const dados = Array.from(form.elements).filter(el => el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA');
        const textoWhatsApp = formatarMensagem(tipo, dados);
        
        window.open(`https://wa.me/5519996600929?text=${encodeURIComponent(textoWhatsApp)}`, '_blank');
        
        btn.textContent = 'Enviado ‚úì';
        setTimeout(() => fecharForm(tipo), 1500);
    }, 1000);
}

function formatarMensagem(tipo, dados) {
    if (tipo === 'Condominio') {
        return `Ol√°! Tenho interesse no Nosso Mercadinho Olypress para meu condom√≠nio:
        
*Nome:* ${dados[0].value}
*Cargo:* ${dados[1].value} 
*Resid√™ncias:* ${dados[2].value}
        
Piracicaba - SP`;
    } else {
        return `Ol√°! Quero ser franqueado do Nosso Mercadinho Olypress:
        
*Nome:* ${dados[0].value}
*Profiss√£o:* ${dados[1].value}
*Experi√™ncia:* ${dados[2].value}
*Motiva√ß√£o:* ${dados[3].value}`;
    }
}

// Emojis baseados no tempo da compra
function atualizarAssistenteComHumor() {
    const tempoDecorrido = Math.floor((new Date() - tempoInicio) / 1000);
    let emoji = "üòä";
    let frase = "Tudo certo por a√≠?";

    if (tempoDecorrido < 20) {
        emoji = "‚ö°";
        frase = "Uau! Est√° r√°pido hoje, hein?";
    } else if (tempoDecorrido > 60) {
        emoji = "üê¢";
        frase = "Sem pressa, aproveite sua escolha!";
    }

    const assistenteMensagem = document.getElementById('mensagem-assistente');
    assistenteMensagem.textContent = `${emoji} ${frase}`;
}

function gerarResumoEmocionalDaCompra() {
    const categorias = {
        'Coca-Cola': 'bebidas',
        '√Ågua': 'bebidas',
        'Suco': 'bebidas',
        'Cerveja': 'bebidas',
        'Vinho': 'bebidas',
        'Doritos': 'snacks',
        'Cheetos': 'snacks',
        'Fini': 'doces',
        'KitKat': 'doces',
        'P√£o': 'padaria',
        'Caf√©': 'padaria',
        'Ma√ß√£': 'organicos',
        'Suco Natural': 'organicos',
        'Mel': 'locais',
        'Queijo': 'locais'
    };

    let contadorCategorias = {
        bebidas: 0,
        snacks: 0,
        doces: 0,
        padaria: 0,
        organicos: 0,
        locais: 0
    };

    sacola.forEach(item => {
        for (const chave in categorias) {
            if (item.nome.includes(chave)) {
                contadorCategorias[categorias[chave]]++;
                break;
            }
        }
    });

    let frase = "Compra feita com sabedoria!";

    const totalCategorias = Object.values(contadorCategorias).filter(v => v > 0).length;

    if (totalCategorias >= 4) {
        frase = "Voc√™ escolheu de tudo um pouco. Gosto equilibrado!";
    } else if (contadorCategorias.bebidas >= 2 && contadorCategorias.doces >= 2) {
        frase = "Doces e bebidas? Uma combina√ß√£o deliciosa!";
    } else if (contadorCategorias.padaria >= 2) {
        frase = "Padaria em dia! Tem caf√© e p√£o a√≠?";
    } else if (contadorCategorias.locais > 0 && contadorCategorias.organicos > 0) {
        frase = "Voc√™ valoriza o que √© natural e da terra. üëè";
    } else if (contadorCategorias.snacks > 2) {
        frase = "Hoje √© dia de filme com petiscos? üçø";
    }

    document.getElementById('resumo-emocional').textContent = frase;
}

function atualizarBarraProgresso(etapaAtual) {
    document.querySelectorAll('#barra-progresso .etapa').forEach(span => {
        if (span.getAttribute('data-etapa') === etapaAtual) {
            span.classList.add('ativa');
        } else {
            span.classList.remove('ativa');
        }
    });
}

// =============================================
// NOVAS FUNCIONALIDADES IMPLEMENTADAS
// =============================================

// 1. SISTEMA DE PERFIL
function alternarMenuPerfil() {
    const menu = document.getElementById('perfilMenu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

function definirPerfil(perfil) {
    perfilUsuario = perfil;
    localStorage.setItem('perfilOlypress', perfil);
    mostrarNotificacao(`Perfil ${perfil} ativado!`);
    aplicarEstiloPerfil();
    document.getElementById('perfilMenu').style.display = 'none';

    if (perfil === 'crianca') {
        ativarModoCrianca();
    }
}

function aplicarEstiloPerfil() {
    document.body.classList.remove(
        'perfil-jovem', 'perfil-empreendedor', 'perfil-sindico', 'perfil-idoso', 'modo-crianca'
    );
    
    if (perfilUsuario !== 'padrao') {
        document.body.classList.add(`perfil-${perfilUsuario}`);
    }
}

// 2. MODO CRIAN√áA
function ativarModoCrianca() {
    document.body.classList.add('modo-crianca');
    document.querySelectorAll('.produto').forEach(botao => {
        if (!botao.innerHTML.includes('üç≠')) {
            botao.innerHTML = botao.innerHTML.replace('R$', 'üç≠ R$');
        }
    });
    document.getElementById('contador-doces').style.display = 'block';
    atualizarContadorDoces();
}

// 3. SISTEMA DE DOCES
function coletarDoce() {
    docesColetados++;
    localStorage.setItem('docesOletados', docesColetados);
    mostrarBombomVirtual();
    atualizarContadorDoces();
}

function mostrarBombomVirtual() {
    const bombom = document.createElement('div');
    bombom.innerHTML = 'üç´';
    bombom.style.position = 'fixed';
    bombom.style.top = '50%';
    bombom.style.left = '50%';
    bombom.style.transform = 'translate(-50%, -50%)';
    bombom.style.fontSize = '50px';
    bombom.style.zIndex = '9999';
    bombom.style.animation = 'pulse 0.5s 3';
    document.body.appendChild(bombom);
    setTimeout(() => bombom.remove(), 2000);
}

function atualizarContadorDoces() {
    const contador = document.getElementById('contador-doces');
    contador.textContent = `Doces: ${docesColetados} üç¨`;
}

// 4. MISS√ïES PARA CRIAN√áAS
function verificarMissaoCrianca() {
    if (perfilUsuario !== 'crianca') return;
    const produtosComC = sacola.filter(item => 
        item.nome.includes('C') || item.nome.includes('c')
    ).length;
    if (produtosComC >= 2) {
        mostrarNotificacao('Miss√£o cumprida! Encontrou produtos com "C" üéâ');
        coletarDoce();
    }
}

// 5. FEEDBACK PERSONALIZADO
function gerarFeedbackPersonalizado() {
    switch (perfilUsuario) {
        case 'jovem': return `‚ö° Voc√™ foi mais r√°pido que 70% dos jovens!`;
        case 'empreendedor': return `üíº Economizaria R$${(calcularTotal() * 0.2).toFixed(2)}/m√™s com um Olypress!`;
        case 'idoso': return `üëµ Compra tranquila e sem pressa!`;
        default: return '';
    }
}
</script>
<div class="selo-confian√ßa">
  üîí Ambiente monitorado ‚Ä¢ Aberto 24h ‚Ä¢ Franquia com prop√≥sito
</div>
</body>
</html>